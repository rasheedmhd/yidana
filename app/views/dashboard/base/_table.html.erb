<%
  # locals: {
  #   table: "instance of Pu::Builders::Table"
  # }

  resource_class = table.model
  resources = table.records
%>
<div class="row">
  <% unless resources.any? %>
    <div class="col-12">
      <%=
        render 'shared/empty_card', message: "You have no #{resource_name_plural(resource_class).downcase}" do
          next unless can_perform?(resource_class, :create)

          link_to "Create #{resource_name(resource_class)}", path_for(resource_class, :new), class: 'btn btn-outline-primary'
        end
      %>
    </div>
  <% else %>
    <div id="table-container" class="col-12 table-responsive max-vh-75 py-2" data-controller="scroll-preserver" data-action="scroll->scroll-preserver#scrolled"  >
      <table class="table table-hover table-striped my-0">
        <thead class="sticky-top">
          <tr>
            <th scope="col" style="min-width: 40px">#</th>
            <% table.columns.each do |name, column| %>
              <th scope="col" style="min-width: 150px;">
                <% if resource_class.ransortable_attributes.include? name.to_s %>
                  <%= sort_link(@q, name, column[:label], class: "text-decoration-none") %>
                <% else %>
                  <%= column[:label] %>
                <% end %>
              </th>
            <% end  %>
            <th scope="col"style="min-width: 150px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% resources.each do |resource| %>
          <tr class="align-middle">
            <td><%= link_to resource.to_param, resource, class: "text-decoration-none" %></td>

            <% table.columns.each do |name, column| %>
              <% column[:value] = resource.send(name) %>
              <%= render 'table_cell', column: %>
            <% end  %>

            <td style="white-space: nowrap;">
              <%= show_button_for(resource, :primary, variant: :table) %>
              <%= edit_button_for(resource, 'warning-emphasis', variant: :table) %>
              <%= delete_button_for(resource, variant: :table) %>
            </td>
          </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <% if table.pagination.present?  %>
      <div class="col-12">
        <%= render 'pagination', pagination: table.pagination %>
      </div>
    <% end  %>
  <% end %>
</div>
